# 情绪日记集合创建指南

## 需要创建的集合

情绪日记功能需要创建以下两个云数据库集合：

1. **emotion_records** - 存储情绪记录
2. **emotion_diary** - 存储情绪日记

## 创建步骤

### 1. 打开云开发控制台

1. 访问 [微信公众平台](https://mp.weixin.qq.com/)
2. 登录您的小程序账号（AppID: `wx88551838ba39bd6c`）
3. 进入 **开发** → **云开发** → **云开发控制台**
4. 选择云环境：`cloud1-4ghau10w942b2505`

### 2. 创建 emotion_records 集合

1. 在云开发控制台，点击 **数据库**
2. 点击 **+** 按钮或 **新建集合**
3. 集合名称输入：`emotion_records`
4. 点击 **确定**
5. **权限设置**：建议设置为 **"仅创建者可读写"**（保护用户隐私）

**集合字段说明**：
- `activityType`: String - 活动类型（'baduanjin' 或 'music'）
- `emotion`: String - 情绪类型（'happy', 'angry', 'sad', 'worry', 'fear'）
- `level`: Number - 情绪等级（1-轻微, 2-中等, 3-强烈）
- `date`: Date - 记录日期
- `createdAt`: Date - 创建时间
- `_openid`: String - 用户openid（系统自动生成）

### 3. 创建 emotion_diary 集合

1. 同样在 **数据库** 页面
2. 点击 **+** 按钮或 **新建集合**
3. 集合名称输入：`emotion_diary`
4. 点击 **确定**
5. **权限设置**：建议设置为 **"仅创建者可读写"**（保护用户隐私）

**集合字段说明**：
- `content`: String - 日记内容（最多1000字）
- `date`: Date - 日记日期
- `createdAt`: Date - 创建时间
- `updatedAt`: Date - 更新时间
- `_openid`: String - 用户openid（系统自动生成）

## 权限设置说明

### 推荐设置：仅创建者可读写

- **优点**：保护用户隐私，只有用户本人可以查看和修改自己的数据
- **适用场景**：情绪和日记属于敏感的个人隐私数据，强烈推荐此设置

### 其他权限选项

- **所有用户可读，仅创建者可写**：不推荐，会泄露用户隐私
- **所有用户可读写**：不推荐，存在安全风险

## 验证集合创建

创建完成后，您应该能在数据库列表中看到：
- ✅ `emotion_records` 集合
- ✅ `emotion_diary` 集合

## 注意事项

1. **集合名称必须完全匹配**：`emotion_records` 和 `emotion_diary`（注意下划线和单复数）
2. **权限设置很重要**：建议设置为"仅创建者可读写"以保护用户隐私
3. **无需手动创建索引**：代码会自动使用默认索引，除非有特殊查询需求

## 如果遇到错误

如果创建集合后仍然报错，请检查：
1. 集合名称是否正确（区分大小写）
2. 是否选择了正确的云环境
3. 网络连接是否正常
4. 云开发服务是否正常

## 相关功能

创建这两个集合后，以下功能将正常工作：
- ✅ 完成健身操后记录心情
- ✅ 完成五音疗法后记录心情
- ✅ 写情绪日记
- ✅ 在数据中心查看情绪柱状图
- ✅ 在打卡日历查看每日情绪和日记

