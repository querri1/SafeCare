# 管理员数据查看指南

## 一、通过微信云开发控制台查看数据

### 1. 访问云开发控制台

1. 打开 [微信公众平台](https://mp.weixin.qq.com/)
2. 登录您的小程序账号（AppID: `wx88551838ba39bd6c`）
3. 进入 **开发** → **云开发** → **云开发控制台**
4. 选择云环境：`cloud1-4ghau10w942b2505`

### 2. 查看云数据库

#### 2.1 用户数据（users 集合）

**集合名称**：`users`

**数据结构**：
```javascript
{
  _id: "文档ID",
  _openid: "用户openid（系统自动生成）",
  nickName: "用户昵称",
  avatarUrl: "用户头像URL",
  gender: 0/1/2, // 0-未知，1-男，2-女
  country: "国家",
  province: "省份",
  city: "城市",
  createdAt: Date, // 创建时间
  updatedAt: Date  // 更新时间
}
```

**查看方式**：
- 在云开发控制台 → **数据库** → 选择 `users` 集合
- 可以查看所有用户信息
- 支持按字段筛选、排序、导出

**数据分析建议**：
- 统计总用户数
- 按省份/城市分析用户分布
- 分析用户注册时间趋势

#### 2.2 测试记录（screening_records 集合）

**集合名称**：`screening_records`

**数据结构**：
```javascript
{
  _id: "文档ID",
  _openid: "用户openid",
  type: "PHQ-9" | "GAD-7" | "SAS", // 测试类型
  answers: [1, 2, 3, ...], // 答案数组
  score: 15, // 总分（PHQ-9/GAD-7直接总分，SAS为标准分）
  rawScore: 40, // 仅SAS有，原始粗分
  severity: "轻度抑郁症状" | "基本无焦虑症状" | "轻度焦虑" | ...,
  createdAt: Date // 测试时间
}
```

**查看方式**：
- 在云开发控制台 → **数据库** → 选择 `screening_records` 集合
- 可以查看所有测试记录
- 支持按 `type`、`createdAt`、`severity` 等字段筛选

**数据分析建议**：
- 统计各类型测试的总次数
- 分析测试结果分布（按 severity 分组统计）
- 分析测试时间趋势（每日/每周/每月）
- 计算平均分、最高分、最低分
- 识别高风险用户（分数较高或严重程度较高）

**示例查询**：
- 查询最近7天的所有测试：`createdAt >= 最近7天`
- 查询PHQ-9测试：`type == "PHQ-9"`
- 查询高风险结果：`severity == "重度抑郁症状"` 或 `score >= 20`

#### 2.3 打卡记录（checkin_records 集合）

**集合名称**：`checkin_records`

**数据结构**：
```javascript
{
  _id: "文档ID",
  _openid: "用户openid",
  date: Date, // 打卡日期（只包含日期，时间部分为00:00:00）
  activities: ["baduanjin", "music", "phq9", "gad7", "sas"], // 活动类型数组
  createdAt: Date, // 创建时间
  updatedAt: Date  // 更新时间
}
```

**活动类型说明**：
- `baduanjin`: 健身操练习（包括趣味健身操和标准八段锦）
- `music`: 五音疗法
- `phq9`: PHQ-9测试
- `gad7`: GAD-7测试
- `sas`: SAS测试

**查看方式**：
- 在云开发控制台 → **数据库** → 选择 `checkin_records` 集合
- 可以查看所有打卡记录
- 支持按 `date`、`activities` 等字段筛选

**数据分析建议**：
- 统计每日打卡人数
- 分析各活动类型的参与度
- 计算用户平均连续打卡天数
- 分析打卡时间分布（工作日 vs 周末）
- 识别活跃用户（打卡频率高）

**示例查询**：
- 查询最近30天的打卡：`date >= 最近30天`
- 查询包含健身操的打卡：`activities array-contains "baduanjin"`
- 查询包含测试的打卡：`activities array-contains-any ["phq9", "gad7", "sas"]`

### 3. 数据导出

在云开发控制台的数据库页面：
1. 选择要导出的集合
2. 点击 **导出** 按钮
3. 选择导出格式（JSON/CSV）
4. 可以导出全部数据或筛选后的数据

### 4. 数据统计

在云开发控制台 → **数据库** → **统计**：
- 可以查看集合的文档数量
- 查看存储空间使用情况
- 查看读写次数统计

---

## 二、通过小程序管理后台页面查看数据（推荐）

为了方便管理员查看数据，我们创建了一个管理后台页面。该页面需要管理员权限才能访问。

### 1. 访问管理后台

**页面路径**：`pages/admin/admin`

**访问方式**：
- 在小程序中添加管理员验证逻辑
- 或通过特定入口进入（如输入管理员密码）

### 2. 功能说明

管理后台页面提供以下功能：

#### 2.1 数据概览
- 总用户数
- 总测试记录数
- 总打卡记录数
- 今日新增用户数
- 今日新增测试数

#### 2.2 用户数据
- 用户列表（昵称、头像、注册时间）
- 用户详情（可查看该用户的所有测试记录和打卡记录）

#### 2.3 测试记录分析
- 按测试类型统计（PHQ-9/GAD-7/SAS）
- 按严重程度统计
- 时间趋势图表
- 平均分统计

#### 2.4 打卡记录分析
- 每日打卡人数统计
- 各活动类型参与度
- 用户活跃度排名

#### 2.5 数据导出
- 导出用户数据为CSV
- 导出测试记录为CSV
- 导出打卡记录为CSV

---

## 三、通过云函数进行数据分析

如果需要更复杂的数据分析，可以创建云函数来执行：

### 示例：统计用户测试结果分布

```javascript
// cloudfunctions/analyze-test-results/index.js
const cloud = require('wx-server-sdk')
cloud.init({
  env: cloud.DYNAMIC_CURRENT_ENV
})

const db = cloud.database()
const _ = db.command

exports.main = async (event, context) => {
  try {
    // 统计各类型测试的数量
    const phq9Count = await db.collection('screening_records')
      .where({ type: 'PHQ-9' })
      .count()
    
    const gad7Count = await db.collection('screening_records')
      .where({ type: 'GAD-7' })
      .count()
    
    const sasCount = await db.collection('screening_records')
      .where({ type: 'SAS' })
      .count()
    
    // 统计各严重程度的分布
    const severityStats = await db.collection('screening_records')
      .aggregate()
      .group({
        _id: '$severity',
        count: $.sum(1)
      })
      .end()
    
    return {
      success: true,
      data: {
        testCounts: {
          phq9: phq9Count.total,
          gad7: gad7Count.total,
          sas: sasCount.total
        },
        severityStats: severityStats.list
      }
    }
  } catch (err) {
    return {
      success: false,
      error: err.message
    }
  }
}
```

---

## 四、数据分析建议

### 1. 用户增长分析
- 每日/每周/每月新增用户数
- 用户留存率（7日留存、30日留存）
- 用户地域分布

### 2. 功能使用分析
- 各功能模块的使用频率
- 用户最常用的功能
- 功能使用时间分布

### 3. 心理健康状况分析
- 测试结果分布（正常/轻度/中度/重度）
- 平均分趋势（是否改善）
- 高风险用户识别
- 测试频率分析

### 4. 用户行为分析
- 打卡习惯（时间、频率）
- 连续打卡天数分布
- 活跃用户特征

### 5. 数据可视化建议
- 使用 Excel、Tableau、Power BI 等工具
- 或使用 Python（pandas + matplotlib）进行数据分析
- 创建仪表板展示关键指标

---

## 五、隐私和安全注意事项

⚠️ **重要提醒**：

1. **数据隐私**：
   - 用户数据属于敏感信息，请妥善保管
   - 不要将数据泄露给第三方
   - 遵守《个人信息保护法》相关规定

2. **数据访问权限**：
   - 仅管理员可以访问完整数据
   - 建议设置管理员权限验证
   - 记录数据访问日志

3. **数据备份**：
   - 定期导出重要数据作为备份
   - 建议每周或每月备份一次

4. **数据脱敏**：
   - 对外分享数据时，应脱敏处理（如隐藏openid、昵称等）

---

## 六、常见问题

### Q1: 如何查看特定用户的所有数据？
A: 在云开发控制台，使用 `_openid` 字段筛选，可以查看该用户在所有集合中的数据。

### Q2: 如何导出数据到Excel？
A: 在云开发控制台导出为CSV格式，然后用Excel打开即可。

### Q3: 如何计算用户留存率？
A: 需要对比不同时间段的用户数据，建议使用云函数或导出数据后用Excel/Python分析。

### Q4: 如何识别高风险用户？
A: 查询 `screening_records` 集合中 `severity` 为"重度"或 `score` 较高的记录，对应的 `_openid` 即为高风险用户。

---

## 七、联系支持

如有问题，请联系技术支持或查看微信云开发官方文档：
- [微信云开发文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html)

