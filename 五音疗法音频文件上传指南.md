# 五音疗法音频文件上传指南

## 概述

五音疗法功能已补全，现在支持所有五音（角、徵、宫、商、羽）的音频播放。需要将音频文件上传到微信云存储。

## 云存储目录结构

```
cloud://cloud1-4ghau10w942b2505.636c-cloud1-4ghau10w942b2505-1390238648/
├── audio/
│   ├── jue/          # 角音（11首，已存在）
│   ├── zhi/          # 徵音（6首，需要上传）
│   ├── gong/         # 宫音（9首，需要上传）
│   ├── shang/        # 商音（10首，需要上传）
│   └── yu/           # 羽音（5首，需要上传）
```

## 音频文件命名规则

### 角音（jue）- 11首（已存在）
- jue-01-jiangnan-sizhu.mp3
- jue-02-caomu-qingqing.mp3
- jue-03-liezi-yufeng.mp3
- jue-04-jiangnan-hao.mp3
- jue-05-gusuxing-orc.mp3
- jue-06-hujia-shibapai.mp3
- jue-08-chunfeng-deyi.mp3
- jue-09-mumin-xinge.mp3.mp3
- jue-10-zhuangzhou-mengdie.mp3
- jue-11-gusuxing-yuxunfa.mp3
- jue-12-zhegufei.mp3

### 徵音（zhi）- 6首（需要上传）

**文件路径：** `audio/zhi/`

| 序号 | 文件名 | 曲目名称 |
|------|--------|----------|
| 1 | zhi-01-zizhu-diao.mp3 | 紫竹调 |
| 2 | zhi-02-xiyangyang.mp3 | 喜洋洋 |
| 3 | zhi-03-xi-xiangfeng.mp3 | 喜相逢 |
| 4 | zhi-04-wenwang-cao.mp3 | 文王操 |
| 5 | zhi-05-shanju-yin.mp3 | 山居吟 |
| 6 | zhi-06-bubugao.mp3 | 步步高 |

### 宫音（gong）- 9首（需要上传）

**文件路径：** `audio/gong/`

| 序号 | 文件名 | 曲目名称 |
|------|--------|----------|
| 1 | gong-01-yueguang-zoumingqu.mp3 | 月光奏鸣曲 |
| 2 | gong-02-yueer-gao.mp3 | 月儿高 |
| 3 | gong-03-xianju-yin.mp3 | 闲居吟 |
| 4 | gong-04-shimian-maifu.mp3 | 十面埋伏 |
| 5 | gong-05-saishang-qu.mp3 | 塞上曲 |
| 6 | gong-06-qiuhu-yueye.mp3 | 秋湖月夜 |
| 7 | gong-07-pinghu-qiuyue.mp3 | 平湖秋月 |
| 8 | gong-08-liangxiao.mp3 | 良宵 |
| 9 | gong-09-chunjiang-huayueye.mp3 | 春江花月夜 |

### 商音（shang）- 10首（需要上传）

**文件路径：** `audio/shang/`

| 序号 | 文件名 | 曲目名称 |
|------|--------|----------|
| 1 | shang-01-changqing.mp3 | 长清 |
| 2 | shang-02-yangchun-baixue.mp3 | 阳春白雪 |
| 3 | shang-03-xiujin-bian.mp3 | 绣金匾 |
| 4 | shang-04-gai-gu-yin.mp3 | 概古吟 |
| 5 | shang-05-jinshe-kuangwu.mp3 | 金蛇狂舞 |
| 6 | shang-06-jiangjun-ling.mp3 | 将军令 |
| 7 | shang-07-huanghe.mp3 | 黄河 |
| 8 | shang-08-heming-jiugao.mp3 | 鹤鸣九皋 |
| 9 | shang-09-guangling-san.mp3 | 广陵散 |
| 10 | shang-10-baixue.mp3 | 白雪 |

### 羽音（yu）- 5首（需要上传）

**文件路径：** `audio/yu/`

| 序号 | 文件名 | 曲目名称 |
|------|--------|----------|
| 1 | yu-01-pingsha-luoyan.mp3 | 平沙落雁 |
| 2 | yu-02-meihua-sannong.mp3 | 梅花三弄 |
| 3 | yu-03-liangzhu.mp3 | 梁祝 |
| 4 | yu-04-hangong-qiuyue.mp3 | 汉宫秋月 |
| 5 | yu-05-erquan-yingyue.mp3 | 二泉映月 |

## 上传步骤

1. **打开微信云开发控制台**
   - 登录微信公众平台
   - 进入小程序管理后台
   - 打开"云开发"控制台

2. **进入云存储**
   - 点击左侧菜单"存储"
   - 进入文件管理页面

3. **创建目录结构**
   - 在 `audio/` 目录下创建以下子目录：
     - `zhi/`（徵音）
     - `gong/`（宫音）
     - `shang/`（商音）
     - `yu/`（羽音）
   - 注意：`jue/` 目录已存在，无需创建

4. **上传音频文件**
   - 进入对应的音律目录（如 `audio/zhi/`）
   - 点击"上传文件"按钮
   - 选择对应的音频文件
   - 确保文件名与命名规则完全一致

5. **设置文件权限**
   - **重要**：上传后必须设置文件权限
   - 点击文件，进入文件详情
   - 将权限设置为"所有用户可读"或"所有用户可读，仅创建者可写"
   - **原因**：安卓端必须使用临时URL，需要文件可公开访问

## 权限设置说明

### 为什么需要设置权限？

- **安卓端兼容性**：安卓端不能直接使用云存储File ID，必须通过临时URL访问
- **临时URL获取**：需要调用 `wx.cloud.getTempFileURL` API，该API要求文件权限为"所有用户可读"
- **错误提示**：如果权限设置不正确，会显示 `STORAGE_EXCEED_AUTHORITY` 错误

### 推荐权限设置

- **选项1**：所有用户可读（推荐，最简单）
- **选项2**：所有用户可读，仅创建者可写（更安全）

## 文件格式要求

- **格式**：MP3
- **建议码率**：128kbps 或 192kbps（平衡音质和文件大小）
- **建议采样率**：44.1kHz
- **文件大小**：建议单首不超过 10MB

## 验证上传

上传完成后，可以通过以下方式验证：

1. **检查文件列表**
   - 在云存储中查看对应目录
   - 确认所有文件都已上传
   - 确认文件名正确

2. **检查文件权限**
   - 点击每个文件，查看权限设置
   - 确认权限为"所有用户可读"

3. **测试播放**
   - 在小程序中进入五音疗法页面
   - 选择对应的音律
   - 确认可以正常加载和播放音频

## 注意事项

1. **文件名必须完全匹配**：代码中使用的文件名与云存储中的文件名必须完全一致（包括大小写）
2. **路径必须正确**：确保文件上传到正确的目录
3. **权限必须设置**：上传后必须设置文件权限，否则无法播放
4. **批量上传**：可以批量上传文件，但需要逐个设置权限
5. **文件替换**：如果需要替换文件，先删除旧文件，再上传新文件

## 代码中的配置

代码中已配置所有五音的播放列表，文件路径格式为：

```
cloud://cloud1-4ghau10w942b2505.636c-cloud1-4ghau10w942b2505-1390238648/audio/{音律类型}/{文件名}.mp3
```

例如：
- 徵音：`cloud://cloud1-4ghau10w942b2505.636c-cloud1-4ghau10w942b2505-1390238648/audio/zhi/zhi-01-zizhu-diao.mp3`
- 宫音：`cloud://cloud1-4ghau10w942b2505.636c-cloud1-4ghau10w942b2505-1390238648/audio/gong/gong-01-yueguang-zoumingqu.mp3`

## 功能说明

### 已实现的功能

✅ 支持所有五音（角、徵、宫、商、羽）音频播放
✅ 按需加载音频（选择音律时才加载对应音频）
✅ 随机起始曲目，然后循环播放
✅ 支持选择指定曲目播放
✅ 支持播放进度条拖动调整
✅ 显示播放列表和当前播放状态
✅ 完成疗愈后记录打卡和情绪

### 使用流程

1. 用户进入五音疗法页面
2. 选择想要体验的音律（角、徵、宫、商、羽）
3. 系统自动加载该音律的音频文件
4. 随机选择起始曲目开始播放
5. 播放完成后自动播放下一首（循环播放）
6. 用户可以随时选择其他曲目
7. 完成疗愈后可以记录心情和写日记

## 技术支持

如有问题，请检查：
1. 文件是否已正确上传到云存储
2. 文件路径和文件名是否正确
3. 文件权限是否设置为"所有用户可读"
4. 网络连接是否正常
5. 音频文件格式是否正确（MP3）

