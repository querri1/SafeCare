# 云数据库集合创建指南

## 创建 checkin_records 集合

### 步骤 1：打开云开发控制台

1. 在微信开发者工具中打开项目
2. 点击顶部菜单栏的 **"云开发"** 按钮（或使用快捷键）
3. 在云开发控制台中，点击左侧菜单的 **"数据库"**

### 步骤 2：创建新集合

1. 在数据库页面，点击 **"+"** 按钮或 **"创建集合"** 按钮
2. 输入集合名称：`checkin_records`
3. 点击 **"确定"** 创建集合

### 步骤 3：设置集合权限

1. 创建集合后，点击集合名称进入集合详情
2. 点击 **"权限设置"** 标签页
3. 建议设置为：
   - **仅创建者可读写**（推荐，更安全）
   - 或 **所有用户可读，仅创建者可写**（如果需要）

### 步骤 4：添加索引（可选，但推荐）

为了提高查询性能，建议为 `date` 字段添加索引：

1. 在集合详情页面，点击 **"索引管理"** 标签页
2. 点击 **"添加索引"**
3. 索引名称：`date_1`
4. 索引字段：选择 `date`，排序方式选择 **"升序"**
5. 点击 **"确定"** 创建索引

### 步骤 5：验证字段类型

集合创建后，字段类型会在首次添加数据时自动确定。但你可以通过以下方式验证：

1. 在集合详情页面，点击 **"数据"** 标签页
2. 点击 **"添加记录"** 按钮
3. 手动添加一条测试数据：

```json
{
  "date": "2024-01-15T00:00:00.000Z",
  "activities": ["baduanjin"],
  "createdAt": "2024-01-15T10:00:00.000Z",
  "updatedAt": "2024-01-15T10:00:00.000Z"
}
```

4. 保存后，系统会自动识别字段类型：
   - `date` 会被识别为 Date 类型
   - `activities` 会被识别为 Array 类型
   - `createdAt` 和 `updatedAt` 会被识别为 Date 类型

5. **测试完成后，可以删除这条测试数据**

## 字段说明

### date (Date类型)
- **用途**：记录打卡日期
- **格式**：Date 对象，会自动转换为时间戳存储
- **示例**：`2024-01-15T00:00:00.000Z`

### activities (Array类型)
- **用途**：记录当天完成的活动类型
- **可能的值**：
  - `"baduanjin"` - 八段锦练习
  - `"music"` - 五音疗法
  - `"phq9"` - PHQ-9测试
  - `"gad7"` - GAD-7测试
- **示例**：`["baduanjin", "music"]`

### createdAt (Date类型)
- **用途**：记录创建时间
- **格式**：Date 对象
- **说明**：系统自动设置

### updatedAt (Date类型)
- **用途**：记录最后更新时间
- **格式**：Date 对象
- **说明**：每次更新记录时自动更新

## 注意事项

1. **日期字段**：云数据库中的 Date 类型字段，在代码中使用 `new Date()` 创建，系统会自动处理
2. **数组字段**：`activities` 字段是数组，可以包含多个活动类型
3. **自动字段**：`_id` 和 `_openid` 是系统自动生成的，不需要手动创建
4. **权限设置**：建议设置为"仅创建者可读写"，确保用户只能查看和修改自己的打卡记录

## 验证集合是否创建成功

创建完成后，可以在小程序代码中测试：

```javascript
const db = wx.cloud.database()
db.collection('checkin_records').get().then(res => {
  console.log('集合创建成功，当前记录数：', res.data.length)
})
```

## 常见问题

### Q: 字段类型显示不正确怎么办？
A: 云数据库的字段类型是根据第一条数据自动推断的。如果类型不对，可以：
1. 删除集合重新创建
2. 或者手动添加一条正确格式的数据，系统会自动识别

### Q: 如何批量导入历史数据？
A: 可以在云开发控制台的数据库页面，使用"导入"功能，导入 JSON 格式的数据文件。

### Q: 索引是必须的吗？
A: 不是必须的，但建议为经常查询的字段（如 `date`）添加索引，可以提高查询性能。

