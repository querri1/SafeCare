<!--治愈中心页面-->
<navigation-bar title="" back="{{false}}" color="black" background="#FFF"></navigation-bar>

<scroll-view class="scrollarea" scroll-y type="list">
  <view class="container">
    <!-- 今日治愈概览 -->
    <view class="healing-overview">
      <view class="overview-card">
        <view class="card-icon">
          <image class="icon-img" src="../../images/icon-shoe.png"></image>
        </view>
        <view class="card-content">
          <text class="card-title">健身操练习</text>
          <text class="card-desc">今日已完成 {{baduanjinProgress}}/1 次</text>
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{baduanjinProgress * 100}}%"></view>
          </view>
        </view>
        <view class="card-action">
          <button class="btn-primary" bindtap="startExercise">开始练习</button>
        </view>
      </view>

      <view class="overview-card">
        <view class="card-icon">
          <image class="icon-img" src="../../images/icon-music.png"></image>
        </view>
        <view class="card-content">
          <text class="card-title">五音疗法</text>
          <text class="card-desc">今日已完成 {{musicProgress}}/1 次</text>
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{musicProgress * 100}}%"></view>
          </view>
        </view>
        <view class="card-action">
          <button class="btn-primary" bindtap="startMusicTherapy">开始疗愈</button>
        </view>
      </view>

      <view class="overview-card">
        <view class="card-icon">
          <image class="icon-img" src="../../images/icon-clipboard.png"></image>
        </view>
        <view class="card-content">
          <text class="card-title">心理健康自测</text>
          <text class="card-desc">最近两周已完成 {{twoWeekTestCount}}/{{maxTwoWeekTests}} 次</text>
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{twoWeekTestCount / maxTwoWeekTests * 100}}%"></view>
          </view>
        </view>
        <view class="card-action">
          <button class="btn-secondary {{testCompleted ? 'btn-completed' : ''}}" bindtap="startTest">
            {{testCompleted ? '继续测试' : '开始测试'}}
          </button>
        </view>
      </view>
    </view>

    <!-- 治愈列表 -->
    <view class="healing-list">
      <view class="section-title">
        <text class="title">今日治愈</text>
        <text class="count">{{showPHQ9GAD7 ? '4' : '3'}} 项治愈</text>
      </view>

      <view class="healing-item {{baduanjinCompleted ? 'completed' : ''}}" bindtap="{{baduanjinCompleted ? 'viewExerciseDetail' : 'startTodayExercise'}}">
        <view class="healing-icon">
          <text class="icon" wx:if="{{baduanjinCompleted}}">✅</text>
          <image class="icon-img" wx:else src="../../images/icon-shoe.png"></image>
        </view>
        <view class="healing-content">
          <text class="healing-title">健身操练习 - {{todayExerciseName}}</text>
          <text class="healing-desc">今日推荐：{{todayExerciseName}}，也可以选择其他健身操</text>
          <text class="healing-time">预计 15 分钟</text>
        </view>
        <view class="healing-status">
          <text class="status-badge completed" wx:if="{{baduanjinCompleted}}">已完成</text>
          <button class="btn-start" wx:else bindtap="startTodayExercise">开始练习</button>
        </view>
      </view>

      <view class="healing-item {{musicCompleted ? 'completed' : ''}}" bindtap="{{musicCompleted ? 'viewExerciseDetail' : 'startMusicTherapy'}}">
        <view class="healing-icon">
          <text class="icon" wx:if="{{musicCompleted}}">✅</text>
          <image class="icon-img" wx:else src="../../images/icon-music.png"></image>
        </view>
        <view class="healing-content">
          <text class="healing-title">五音疗法</text>
          <text class="healing-desc">角徵宫商羽，五音守护你</text>
          <text class="healing-time">预计 10 分钟</text>
        </view>
        <view class="healing-status">
          <text class="status-badge completed" wx:if="{{musicCompleted}}">已完成</text>
          <button class="btn-start" wx:else bindtap="startMusicTherapy">开始疗愈</button>
        </view>
      </view>

      <view class="healing-item" wx:if="{{showPHQ9GAD7}}" bindtap="startTodayTest1">
        <view class="healing-icon">
          <image class="icon-img" wx:if="{{todayTest1 === 'PHQ-9'}}" src="../../images/icon-brain.png"></image>
          <image class="icon-img" wx:elif="{{todayTest1 === 'GAD-7'}}" src="../../images/icon-heart.png"></image>
          <image class="icon-img" wx:else src="../../images/icon-brain.png"></image>
        </view>
        <view class="healing-content">
          <text class="healing-title">{{todayTest1Name}}</text>
          <text class="healing-desc">评估过去两周的情绪状态</text>
          <text class="healing-time">预计 5 分钟</text>
        </view>
        <view class="healing-status">
          <button class="btn-start">开始测试</button>
        </view>
      </view>

      <view class="healing-item" bindtap="startSASTest">
        <view class="healing-icon">
          <image class="icon-img" src="../../images/icon-brain.png"></image>
        </view>
        <view class="healing-content">
          <text class="healing-title">焦虑自评量表 SAS</text>
          <text class="healing-desc">评估过去两周的情绪状态</text>
          <text class="healing-time">预计 5 分钟</text>
        </view>
        <view class="healing-status">
          <button class="btn-start">开始测试</button>
        </view>
      </view>

      <view class="healing-item" bindtap="openEmotionDiary">
        <view class="healing-icon">
          <text class="icon">📝</text>
        </view>
        <view class="healing-content">
          <text class="healing-title">情绪日记</text>
          <text class="healing-desc">{{diaryHint}}</text>
        </view>
        <view class="healing-status">
          <button class="btn-start">写日记</button>
        </view>
      </view>
    </view>
  </view>
</scroll-view>

