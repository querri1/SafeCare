# 云存储权限配置指南

## 问题说明

在安卓端运行时，如果出现 `STORAGE_EXCEED_AUTHORITY` 错误，说明云存储文件权限设置不正确。

**重要**：安卓端必须使用临时URL播放音频和视频，不能直接使用云存储File ID。因此需要确保文件权限允许获取临时URL。

## 解决方案

### 方法一：设置文件权限为"所有用户可读"（推荐）

1. 打开微信开发者工具
2. 点击顶部菜单栏的 **"云开发"** 按钮
3. 在云开发控制台中，点击左侧菜单的 **"存储"**
4. 找到需要修改的音频/视频文件（在 `audio/jue/` 或 `video/` 目录下）
5. 点击文件名称进入文件详情
6. 点击 **"权限设置"** 或 **"更多"** → **"权限设置"**
7. 将权限设置为：**"所有用户可读"**
8. 点击 **"确定"** 保存

### 方法二：批量设置文件夹权限

1. 在云开发控制台的存储页面
2. 找到 `audio/jue/` 文件夹
3. 右键点击文件夹，选择 **"批量设置权限"**
4. 设置为：**"所有用户可读"**
5. 同样设置 `video/` 文件夹

### 方法三：使用云函数获取临时URL（高级）

如果不想设置文件为公开，可以使用云函数来获取临时URL，但需要额外的开发工作。

## 需要设置权限的文件

### 音频文件（12个）
- `audio/jue/jue-01-jiangnan-sizhu.mp3`
- `audio/jue/jue-02-caomu-qingqing.mp3`
- `audio/jue/jue-03-liezi-yufeng.mp3`
- `audio/jue/jue-04-jiangnan-hao.mp3`
- `audio/jue/jue-05-gusuxing-orc.mp3`
- `audio/jue/jue-06-hujia-shibapai.mp3`
- `audio/jue/jue-07-liangzhu.mp3`
- `audio/jue/jue-08-chunfeng-deyi.mp3`
- `audio/jue/jue-09-mumin-xinge.mp3.mp3`
- `audio/jue/jue-10-zhuangzhou-mengdie.mp3`
- `audio/jue/jue-11-gusuxing-yuxunfa.mp3`
- `audio/jue/jue-12-zhegufei.mp3`

### 视频文件（2个）
- `video/baduanjin-9f2582a4.mp4`（标准八段锦）
- `video/fun-exercise.mp4`（趣味健身操，需要上传）

## 权限设置说明

### 权限选项说明

1. **仅创建者可读写**
   - 只有上传文件的用户（开发者）可以访问
   - 其他用户无法获取临时URL
   - ❌ **不适用于小程序用户访问**

2. **所有用户可读，仅创建者可写**
   - 所有用户都可以读取文件
   - 可以获取临时URL
   - ✅ **推荐用于音频和视频文件**

3. **所有用户可读写**
   - 所有用户都可以读取和写入
   - 可以获取临时URL
   - ⚠️ **不推荐，存在安全风险**

## 验证权限设置

设置权限后，可以通过以下方式验证：

1. 在小程序中重新加载页面
2. 查看控制台日志，应该能看到成功获取临时URL的日志
3. 如果仍然失败，检查：
   - 文件是否确实存在
   - File ID 是否正确
   - 网络连接是否正常

## 常见问题

### Q: 为什么iOS可以播放，但安卓不行？

A: iOS在某些情况下可以直接使用云存储File ID，但安卓端必须使用临时URL。因此需要确保文件权限允许获取临时URL。

### Q: 设置权限后仍然失败？

A: 请检查：
1. 文件是否确实存在于云存储中
2. File ID 路径是否正确（格式：`cloud://环境ID.云存储标识/文件路径`）
3. 是否使用了正确的云环境ID

### Q: 如何批量设置权限？

A: 在云开发控制台的存储页面，可以：
1. 选中多个文件
2. 点击"批量操作" → "设置权限"
3. 选择"所有用户可读"

## 注意事项

1. **安全性**：设置为"所有用户可读"后，任何知道File ID的用户都可以访问文件。对于音频和视频文件，这通常是可接受的。

2. **性能**：临时URL有时效性（通常2小时），小程序会自动处理URL刷新。

3. **成本**：获取临时URL会产生少量云开发调用次数，但通常不会产生额外费用。

---

**提示**：如果按照上述步骤设置后仍然出现问题，请检查云开发环境配置和网络连接。

